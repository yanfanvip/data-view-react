{"version":3,"file":"index.js","sources":["../../src/components/digitalFlop/index.js"],"sourcesContent":["import React, { useEffect, useRef, useMemo } from 'react'\n\nimport PropTypes from 'prop-types'\n\nimport classnames from 'classnames'\n\nimport CRender from '@jiaminghi/c-render'\n\nimport '@jiaminghi/charts/lib/extend/index'\n\nimport { deepMerge } from '@jiaminghi/charts/lib/util/index'\n\nimport { deepClone } from '@jiaminghi/c-render/lib/plugin/util'\n\nimport './style.less'\n\nconst defaultConfig = {\n  /**\n   * @description Number for digital flop\n   * @type {Array<Number>}\n   * @default number = []\n   * @example number = [10]\n   */\n  number: [],\n  /**\n   * @description Content formatter\n   * @type {String}\n   * @default content = ''\n   * @example content = '{nt}ä¸ª'\n   */\n  content: '',\n  /**\n   * @description Number toFixed\n   * @type {Number}\n   * @default toFixed = 0\n   */\n  toFixed: 0,\n  /**\n   * @description Text align\n   * @type {String}\n   * @default textAlign = 'center'\n   * @example textAlign = 'center' | 'left' | 'right'\n   */\n  textAlign: 'center',\n  /**\n   * @description rowGap\n   * @type {Number}\n   *@default rowGap = 0\n   */\n  rowGap: 0,\n  /**\n   * @description Text style configuration\n   * @type {Object} {CRender Class Style}\n   */\n  style: {\n    fontSize: 30,\n    fill: '#3de7c9'\n  },\n  /**\n   * @description Number formatter\n   * @type {Null|Function}\n   */\n  formatter: undefined,\n  /**\n   * @description CRender animationCurve\n   * @type {String}\n   * @default animationCurve = 'easeOutCubic'\n   */\n  animationCurve: 'easeOutCubic',\n  /**\n   * @description CRender animationFrame\n   * @type {String}\n   * @default animationFrame = 50\n   */\n  animationFrame: 50\n}\n\nconst DigitalFlop = ({ config = {}, className, style }) => {\n  const domRef = useRef(null)\n  const rendererRef = useRef(null)\n  const graphRef = useRef(null)\n\n  function getGraph(mergedConfig) {\n    const { animationCurve, animationFrame } = mergedConfig\n\n    return rendererRef.current.add({\n      name: 'numberText',\n      animationCurve,\n      animationFrame,\n      shape: getShape(mergedConfig),\n      style: getStyle(mergedConfig)\n    })\n  }\n\n  function getShape({ number, content, toFixed, textAlign, rowGap, formatter }) {\n    const [w, h] = rendererRef.current.area\n\n    const position = [w / 2, h / 2]\n\n    if (textAlign === 'left') position[0] = 0\n    if (textAlign === 'right') position[0] = w\n\n    return { number, content, toFixed, position, rowGap, formatter }\n  }\n\n  function getStyle({ style, textAlign }) {\n    return deepMerge(style, {\n      textAlign,\n      textBaseline: 'middle'\n    })\n  }\n\n  useEffect(() => {\n    const mergedConfig = deepMerge(deepClone(defaultConfig, true), config || {})\n\n    if (!rendererRef.current) {\n      rendererRef.current = new CRender(domRef.current)\n\n      graphRef.current = getGraph(mergedConfig)\n    }\n\n    const graph = graphRef.current\n    graph.animationEnd()\n\n    const shape = getShape(mergedConfig)\n\n    const cacheNum = graph.shape.number.length\n    const shapeNum = shape.number.length\n\n    cacheNum !== shapeNum && (graph.shape.number = shape.number)\n\n    const { animationCurve, animationFrame } = mergedConfig\n\n    Object.assign(graph, { animationCurve, animationFrame })\n\n    graph.animation('style', getStyle(mergedConfig), true)\n    graph.animation('shape', shape)\n  }, [config])\n\n  const classNames = useMemo(() => classnames('dv-digital-flop', className), [\n    className\n  ])\n\n  return (\n    <div className={classNames} style={style}>\n      <canvas ref={domRef} />\n    </div>\n  )\n}\n\nDigitalFlop.propTypes = {\n  config: PropTypes.object,\n  className: PropTypes.string,\n  style: PropTypes.object\n}\n\nexport default DigitalFlop\n"],"names":["defaultConfig","number","content","toFixed","textAlign","rowGap","style","fontSize","fill","formatter","undefined","animationCurve","animationFrame","DigitalFlop","config","className","domRef","useRef","rendererRef","graphRef","getGraph","mergedConfig","current","add","name","shape","getShape","getStyle","area","w","h","position","deepMerge","textBaseline","useEffect","deepClone","CRender","graph","animationEnd","cacheNum","length","shapeNum","Object","assign","animation","classNames","useMemo","classnames","React","propTypes","PropTypes","object","string"],"mappings":"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"}